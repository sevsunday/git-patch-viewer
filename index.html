<!DOCTYPE html>
<html lang="en" class="theme-cosmic-night dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Git Diff & Patch Viewer</title>
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Git Patch Viewer">
  <meta property="og:description" content="View and share git patches with beautiful syntax highlighting">
  <meta property="og:url" content="" id="og-url">
  <meta property="og:type" content="website">
  
  <!-- CDN Dependencies -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css">
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="./css/themes.css">
  <link rel="stylesheet" href="./css/viewer.css">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“„</text></svg>">
</head>
<body>
  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-to-content">Skip to main content</a>
  
  <!-- Header -->
  <header class="app-header" role="banner">
    <div class="header-left">
      <h1 class="app-title">
        <svg class="app-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        Git Diff & Patch Viewer
      </h1>
      <button id="new-patch-btn" class="btn-ghost hidden" title="Go back">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Back
      </button>
      <!-- Patch Statistics (shown when viewing patch) -->
      <div id="header-stats" class="header-stats hidden">
        <div class="stat-badge stat-files" title="Files changed">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          <span id="stat-files-value">0</span>
        </div>
        <div class="stat-badge stat-additions" title="Lines added">
          <span class="stat-symbol">+</span>
          <span id="stat-additions-value">0</span>
        </div>
        <div class="stat-badge stat-deletions" title="Lines deleted">
          <span class="stat-symbol">âˆ’</span>
          <span id="stat-deletions-value">0</span>
        </div>
      </div>
    </div>
    <div class="header-right">
      <!-- Theme Selector -->
      <div class="theme-selector">
        <button id="theme-button" class="theme-btn" aria-label="Select theme" title="Change theme">
          <span class="theme-preview" style="background: #a48fff"></span>
          <span class="theme-name">Cosmic Night</span>
          <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div id="theme-dropdown" class="theme-dropdown hidden">
          <input type="text" id="theme-search" placeholder="Search themes..." autocomplete="off">
          <div id="theme-list" class="theme-list">
            <!-- Themes populated by JS -->
          </div>
        </div>
      </div>
      
      <!-- Dark/Light Toggle -->
      <button id="mode-toggle" class="mode-toggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode">
        <svg id="mode-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
      
      <!-- Action Buttons -->
      <button id="saved-btn" class="action-btn" aria-label="Saved patches" title="View saved patches">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
        </svg>
        <span id="saved-count" class="badge">0</span>
      </button>
      <button id="save-patch-btn" class="action-btn hidden" aria-label="Save patch" title="Save this patch">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
        </svg>
      </button>
      <button id="save-patch-filled-btn" class="action-btn hidden" aria-label="Patch saved" title="This is a saved patch" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
          <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
        </svg>
      </button>
      <button id="share-btn" class="action-btn hidden" aria-label="Share patch" title="Share this patch">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="18" cy="5" r="3"></circle>
          <circle cx="6" cy="12" r="3"></circle>
          <circle cx="18" cy="19" r="3"></circle>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
        </svg>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main id="main-content" class="app-main" role="main">
    <!-- Input Interface (shown when no patch loaded) -->
    <section id="input-section" class="input-section">
      <div class="input-container">
        <h2 class="input-title">Load a Git Diff or Patch</h2>
        
        <div class="input-columns">
          <!-- Left Column: Browse/Paste -->
          <div class="input-column-left">
            <!-- Drag & Drop Zone -->
            <div id="drop-zone" class="drop-zone">
              <svg class="drop-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <p class="drop-text">Drag and drop a patch file here</p>
              <p class="drop-subtext">Supports .patch, .diff, and .txt files</p>
              <p class="text-divider">or</p>
              <button id="browse-btn" class="btn-primary">Browse Files</button>
              <input type="file" id="file-input" accept=".patch,.diff,.txt" hidden>
            </div>
            
            <!-- Textarea for Paste -->
            <div class="textarea-container">
              <label for="patch-textarea">Or paste patch content:</label>
              <textarea id="patch-textarea" placeholder="diff --git a/file.js b/file.js&#10;index abc123..def456 100644&#10;--- a/file.js&#10;+++ b/file.js&#10;@@ -1,3 +1,4 @@&#10; function hello() {&#10;+  console.log('Hello!');&#10;   return 'world';&#10; }"></textarea>
              <div class="textarea-actions">
                <button id="parse-btn" class="btn-primary">View Patch</button>
                <button id="clear-btn" class="btn-secondary">Clear</button>
              </div>
            </div>
          </div>
          
          <!-- Right Column: Recent Patches -->
          <div class="input-column-right">
            <div id="recent-patches" class="recent-patches hidden">
              <h3>Recently Saved Patches</h3>
              <div id="recent-list" class="recent-list">
                <!-- Populated by JS -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Viewer Interface (shown when patch loaded) -->
    <section id="viewer-section" class="viewer-section hidden">
      <!-- Git Metadata Card -->
      <div id="metadata-card" class="metadata-card hidden">
        <!-- Populated by JS -->
      </div>
      
      <div class="viewer-layout">
        <!-- File Sidebar -->
        <aside id="file-sidebar" class="file-sidebar" role="navigation" aria-label="File navigation">
          <div class="sidebar-header">
            <div class="sidebar-header-top">
              <h3>Files Changed</h3>
              <div class="sidebar-header-actions">
                <button id="sidebar-collapse-btn" class="btn-icon sidebar-collapse-btn" title="Collapse sidebar" aria-label="Collapse sidebar">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                  </svg>
                </button>
                <button id="files-settings-btn" class="btn-icon files-settings-btn" title="View settings" aria-label="File view settings">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.24 4.24l-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66l-4.24-4.24m-4.24-4.24l-4.24-4.24"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="sidebar-search">
              <input type="text" id="files-search" placeholder="Search files..." autocomplete="off" aria-label="Search files">
              <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
            <!-- Settings Dropdown -->
            <div id="files-settings-dropdown" class="files-settings-dropdown hidden">
              <div class="settings-option">
                <label class="checkbox-label">
                  <input type="checkbox" id="tree-view-toggle">
                  <span>Show folder structure</span>
                </label>
              </div>
            </div>
          </div>
          <div class="sidebar-content" role="tree">
            <!-- Populated by JS -->
          </div>
        </aside>
        
        <!-- Diff Container -->
        <div class="diff-wrapper">
          <div class="diff-controls">
            <div class="view-toggle">
              <button id="unified-btn" class="view-btn" title="Unified view">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="21" y1="10" x2="3" y2="10"></line>
                  <line x1="21" y1="6" x2="3" y2="6"></line>
                  <line x1="21" y1="14" x2="3" y2="14"></line>
                  <line x1="21" y1="18" x2="3" y2="18"></line>
                </svg>
                Unified
              </button>
              <button id="sidebyside-btn" class="view-btn active" title="Side-by-side view">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="18"></rect>
                  <rect x="14" y="3" width="7" height="18"></rect>
                </svg>
                Side-by-side
              </button>
            </div>
            <div class="diff-actions">
              <button id="expand-all-files" class="btn-ghost" title="Expand all files">Expand All</button>
              <button id="collapse-all-files" class="btn-ghost" title="Collapse all files">Collapse All</button>
              <button id="copy-all-btn" class="btn-ghost" title="Copy entire patch">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy All
              </button>
            </div>
          </div>
          <div id="diff-container" class="diff-container">
            <!-- Populated by diff2html -->
          </div>
        </div>
      </div>
    </section>
    
    <!-- Saved Patches Sidebar (slide-in) - Accessible from anywhere -->
    <aside id="saved-sidebar" class="saved-sidebar hidden">
      <div class="saved-header">
        <h3>Saved Patches</h3>
        <button id="close-saved-btn" class="btn-icon" aria-label="Close saved patches panel">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      <div class="saved-controls">
        <input type="text" id="saved-search" placeholder="Search saved patches..." autocomplete="off">
        <select id="saved-sort" class="sort-select">
          <option value="date">Sort by Date</option>
          <option value="name">Sort by Name</option>
          <option value="size">Sort by Size</option>
        </select>
      </div>
      <div id="saved-list" class="saved-list">
        <!-- Populated by JS -->
      </div>
    </aside>
  </main>

  <!-- Share Modal -->
  <div id="share-modal" class="modal hidden" role="dialog" aria-labelledby="share-modal-title" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="share-modal-title">Share This Patch</h2>
        <button class="btn-icon close-modal" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="share-url-container">
          <label for="share-url-input">Shareable Link:</label>
          <input type="text" id="share-url-input" readonly>
          <div id="url-length-info" class="url-info">
            <!-- Populated by JS -->
          </div>
          <div class="url-input-group">
            <button id="copy-share-url-btn" class="btn-primary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
            <button id="save-share-patch-btn" class="btn-secondary hidden">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
              </svg>
              Save
            </button>
          </div>
        </div>
        <div class="share-options">
          <label class="checkbox-label">
            <input type="checkbox" id="include-theme-checkbox">
            <span>Include current theme in link</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Patch Already Saved Modal -->
  <div id="patch-exists-modal" class="modal hidden" role="dialog" aria-labelledby="patch-exists-title" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-content modal-compact">
      <div class="modal-header modal-header-with-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" style="color: var(--accent-primary);">
          <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
        </svg>
        <h2 id="patch-exists-title">This Patch is Already Saved</h2>
      </div>
      <div class="modal-body">
        <p class="modal-message">You've previously saved this patch. Would you like to load the saved version or save a new copy?</p>
        <div class="modal-actions">
          <button id="load-existing-patch-btn" class="btn-primary">
            Load Saved Patch
          </button>
          <button id="save-new-copy-btn" class="btn-secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save New Copy
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Keyboard Help Modal -->
  <div id="help-modal" class="modal hidden" role="dialog" aria-labelledby="help-modal-title" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="help-modal-title">Keyboard Shortcuts</h2>
        <button class="btn-icon close-modal" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="shortcuts-grid">
          <div class="shortcut-item">
            <kbd>/</kbd>
            <span>Focus search</span>
          </div>
          <div class="shortcut-item">
            <kbd>Esc</kbd>
            <span>Close modals/clear search</span>
          </div>
          <div class="shortcut-item">
            <kbd>j</kbd>
            <span>Next file</span>
          </div>
          <div class="shortcut-item">
            <kbd>k</kbd>
            <span>Previous file</span>
          </div>
          <div class="shortcut-item">
            <kbd>u</kbd>
            <span>Unified view</span>
          </div>
          <div class="shortcut-item">
            <kbd>s</kbd>
            <span>Side-by-side view</span>
          </div>
          <div class="shortcut-item">
            <kbd>c</kbd>
            <span>Copy current file</span>
          </div>
          <div class="shortcut-item">
            <kbd>t</kbd>
            <span>Theme selector</span>
          </div>
          <div class="shortcut-item">
            <kbd>?</kbd>
            <span>Show this help</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>
  
  <!-- Loading Spinner -->
  <div id="loading" class="loading hidden" role="alert" aria-live="assertive" aria-busy="true">
    <div class="spinner" aria-hidden="true"></div>
    <p>Processing patch...</p>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-typescript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-java.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-go.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-rust.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-css.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-markup.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-markdown.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pako@2/dist/pako.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
  
  <!-- Custom Scripts -->
  <script src="./js/themeManager.js"></script>
  <script src="./js/parser.js"></script>
  <script src="./js/urlHandler.js"></script>
  <script src="./js/storage.js"></script>
  <script src="./js/viewer.js"></script>
  
  <!-- Initialize -->
  <script>
    // Set Open Graph URL dynamically (platform-agnostic)
    document.getElementById('og-url').content = window.location.href;
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      ThemeManager.init();
      Viewer.init();
    });
  </script>
</body>
</html>

